<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- <link rel="icon" type="image/svg+xml" href="/vite.svg" /> -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <!-- <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Rubik+Mono+One:wght@400&display=swap"
    /> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/eruda"></script> -->
    <title>Scout</title>
    <style>
      .splash__container {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1000;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        transition: all 0.2s ease-in-out;

        gap: 40px;

        width: 100%;
        height: 100%;
        background: var(
          --gradient,
          linear-gradient(113deg, oklch(0.36 0.05 230) 0%, oklch(0.28 0.04 240) 84.92%)
        );
      }

      /* rotate loader */
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .splash__loader {
        animation: rotate 1s linear infinite;
        opacity: 0.5;
        transform-origin: center;
      }
    </style>
    <script>
      // ensure that mini-app is full height
      try {
        window.TelegramWebviewProxy.postEvent("web_app_expand");
        window.TelegramWebviewProxy.postEvent("web_app_ready");
      } catch (e) {
        console.error(e);
      }

      !(async function auth() {
        try {
          console.log("auth");
          if (!location.hash.includes("tgWebAppData")) {
            console.log(location.hash);
            document.addEventListener("DOMContentLoaded", () => {
              document.querySelector(".splash__container").remove();
            });
            return;
          }
          console.log("web data found");
          const initData = decodeURIComponent(
            location.hash.split("#tgWebAppData=").slice(1)[0].split("&")[0]
          );
          const response = await fetch(
            `https://f2680e3a5b24.ngrok-free.app/api/v1/auth/tg/login?${initData}`,
            {
              headers: {
                "ngrok-skip-browser-warning": "69420",
              },
            }
          );
          const data = await response.json();
          localStorage.setItem("accessToken", data.accessToken);
          localStorage.setItem("refreshToken", data.refreshToken);
          console.log("set tokens");

          const profileResponse = await fetch(
            `https://f2680e3a5b24.ngrok-free.app/api/v1/profile`,
            {
              headers: {
                Authorization: `Bearer ${data.accessToken}`,
                "ngrok-skip-browser-warning": "69420",
              },
            }
          );
          const profileData = await profileResponse.json();

          if (
            Object.keys(profileData || {}).length > 0 &&
            !profileData?.flags?.hasSeenOnboarding
          ) {
            window.history.pushState({}, "", "/onboarding");
            setTimeout(() => {
              document.querySelector(".splash__container").style.paddingBottom =
                "40vh";
              document.querySelector(".splash__container").style.filter =
                "blur(5px)";
              document.querySelector(".splash__loader").style.opacity = "0.5";
              setTimeout(() => {
                document.querySelector(".splash__container").remove();
              }, 120);
            }, 50);
          }
           else document.querySelector(".splash__container").remove();
        } catch (e) {
          document.querySelector(".splash__container").remove();
          console.error(e);
        }
      })();
    </script>
  </head>
  <body>
    <div class="splash__container">
      <div class="splash__logo">
        <svg
          width="261"
          height="73"
          viewBox="0 0 261 73"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M40.9432 21.2614C40.6705 18.5114 39.5 16.375 37.4318 14.8523C35.3636 13.3295 32.5568 12.5682 29.0114 12.5682C26.6023 12.5682 24.5682 12.9091 22.9091 13.5909C21.25 14.25 19.9773 15.1705 19.0909 16.3523C18.2273 17.5341 17.7955 18.875 17.7955 20.375C17.75 21.625 18.0114 22.7159 18.5795 23.6477C19.1705 24.5795 19.9773 25.3864 21 26.0682C22.0227 26.7273 23.2045 27.3068 24.5455 27.8068C25.8864 28.2841 27.3182 28.6932 28.8409 29.0341L35.1136 30.5341C38.1591 31.2159 40.9545 32.125 43.5 33.2614C46.0455 34.3977 48.25 35.7955 50.1136 37.4545C51.9773 39.1136 53.4205 41.0682 54.4432 43.3182C55.4886 45.5682 56.0227 48.1477 56.0455 51.0568C56.0227 55.3295 54.9318 59.0341 52.7727 62.1705C50.6364 65.2841 47.5455 67.7045 43.5 69.4318C39.4773 71.1364 34.625 71.9886 28.9432 71.9886C23.3068 71.9886 18.3977 71.125 14.2159 69.3977C10.0568 67.6705 6.80682 65.1136 4.46591 61.7273C2.14773 58.3182 0.931818 54.1023 0.818182 49.0795H15.1023C15.2614 51.4205 15.9318 53.375 17.1136 54.9432C18.3182 56.4886 19.9205 57.6591 21.9205 58.4545C23.9432 59.2273 26.2273 59.6136 28.7727 59.6136C31.2727 59.6136 33.4432 59.25 35.2841 58.5227C37.1477 57.7955 38.5909 56.7841 39.6136 55.4886C40.6364 54.1932 41.1477 52.7045 41.1477 51.0227C41.1477 49.4545 40.6818 48.1364 39.75 47.0682C38.8409 46 37.5 45.0909 35.7273 44.3409C33.9773 43.5909 31.8295 42.9091 29.2841 42.2955L21.6818 40.3864C15.7955 38.9545 11.1477 36.7159 7.73864 33.6705C4.32955 30.625 2.63636 26.5227 2.65909 21.3636C2.63636 17.1364 3.76136 13.4432 6.03409 10.2841C8.32955 7.125 11.4773 4.65909 15.4773 2.88636C19.4773 1.11363 24.0227 0.22727 29.1136 0.22727C34.2955 0.22727 38.8182 1.11363 42.6818 2.88636C46.5682 4.65909 49.5909 7.125 51.75 10.2841C53.9091 13.4432 55.0227 17.1023 55.0909 21.2614H40.9432ZM87.2488 72.0227C81.8852 72.0227 77.2715 70.8864 73.4079 68.6136C69.567 66.3182 66.6124 63.1364 64.5443 59.0682C62.4988 55 61.4761 50.3182 61.4761 45.0227C61.4761 39.6591 62.5102 34.9545 64.5783 30.9091C66.6693 26.8409 69.6352 23.6705 73.4761 21.3977C77.317 19.1023 81.8852 17.9545 87.1806 17.9545C91.7488 17.9545 95.7488 18.7841 99.1806 20.4432C102.612 22.1023 105.328 24.4318 107.328 27.4318C109.328 30.4318 110.431 33.9545 110.635 38H96.9306C96.5443 35.3864 95.5215 33.2841 93.8624 31.6932C92.2261 30.0795 90.0783 29.2727 87.4193 29.2727C85.1693 29.2727 83.2033 29.8864 81.5215 31.1136C79.8624 32.3182 78.567 34.0795 77.6352 36.3977C76.7033 38.7159 76.2374 41.5227 76.2374 44.8182C76.2374 48.1591 76.692 51 77.6011 53.3409C78.5329 55.6818 79.8397 57.4659 81.5215 58.6932C83.2033 59.9205 85.1693 60.5341 87.4193 60.5341C89.0783 60.5341 90.567 60.1932 91.8852 59.5114C93.2261 58.8295 94.3283 57.8409 95.192 56.5455C96.0783 55.2273 96.6579 53.6477 96.9306 51.8068H110.635C110.408 55.8068 109.317 59.3295 107.362 62.375C105.431 65.3977 102.76 67.7614 99.3511 69.4659C95.942 71.1705 91.9079 72.0227 87.2488 72.0227ZM141.481 72.0227C136.185 72.0227 131.606 70.8977 127.742 68.6477C123.901 66.375 120.935 63.2159 118.844 59.1705C116.753 55.1023 115.708 50.3864 115.708 45.0227C115.708 39.6136 116.753 34.8864 118.844 30.8409C120.935 26.7727 123.901 23.6136 127.742 21.3636C131.606 19.0909 136.185 17.9545 141.481 17.9545C146.776 17.9545 151.344 19.0909 155.185 21.3636C159.049 23.6136 162.026 26.7727 164.117 30.8409C166.208 34.8864 167.253 39.6136 167.253 45.0227C167.253 50.3864 166.208 55.1023 164.117 59.1705C162.026 63.2159 159.049 66.375 155.185 68.6477C151.344 70.8977 146.776 72.0227 141.481 72.0227ZM141.549 60.7727C143.958 60.7727 145.969 60.0909 147.583 58.7273C149.196 57.3409 150.412 55.4545 151.231 53.0682C152.071 50.6818 152.492 47.9659 152.492 44.9205C152.492 41.875 152.071 39.1591 151.231 36.7727C150.412 34.3864 149.196 32.5 147.583 31.1136C145.969 29.7273 143.958 29.0341 141.549 29.0341C139.117 29.0341 137.071 29.7273 135.412 31.1136C133.776 32.5 132.537 34.3864 131.696 36.7727C130.878 39.1591 130.469 41.875 130.469 44.9205C130.469 47.9659 130.878 50.6818 131.696 53.0682C132.537 55.4545 133.776 57.3409 135.412 58.7273C137.071 60.0909 139.117 60.7727 141.549 60.7727ZM208.164 48.7045V18.6364H222.687V71H208.744V61.4886H208.198C207.016 64.5568 205.05 67.0227 202.3 68.8864C199.573 70.75 196.244 71.6818 192.312 71.6818C188.812 71.6818 185.732 70.8864 183.073 69.2955C180.414 67.7045 178.334 65.4432 176.834 62.5114C175.357 59.5795 174.607 56.0682 174.584 51.9773V18.6364H189.107V49.3864C189.13 52.4773 189.959 54.9205 191.596 56.7159C193.232 58.5114 195.425 59.4091 198.175 59.4091C199.925 59.4091 201.562 59.0114 203.084 58.2159C204.607 57.3977 205.834 56.1932 206.766 54.6023C207.721 53.0114 208.187 51.0455 208.164 48.7045ZM260.043 18.6364V29.5455H228.509V18.6364H260.043ZM235.668 6.09091H250.191V54.9091C250.191 56.25 250.396 57.2955 250.805 58.0455C251.214 58.7727 251.782 59.2841 252.509 59.5795C253.259 59.875 254.123 60.0227 255.1 60.0227C255.782 60.0227 256.464 59.9659 257.146 59.8523C257.828 59.7159 258.35 59.6136 258.714 59.5455L260.998 70.3523C260.271 70.5795 259.248 70.8409 257.93 71.1364C256.612 71.4545 255.009 71.6477 253.123 71.7159C249.623 71.8523 246.555 71.3864 243.918 70.3182C241.305 69.25 239.271 67.5909 237.816 65.3409C236.362 63.0909 235.646 60.25 235.668 56.8182V6.09091Z"
            fill="white"
          />
        </svg>
      </div>
      <div class="splash__loader">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="36"
          height="36"
          viewBox="0 0 36 36"
          fill="none"
        >
          <path
            d="M18 2
               A16 16 0 0 1 34 18
               A16 16 0 0 1 18 34
               A16 16 0 0 1 2 18"
            stroke="white"
            stroke-width="4"
            stroke-linecap="round"
            fill="none"
          />
        </svg>
      </div>
    </div>
    <div id="app"></div>
    <script defer type="module" src="/src/main.tsx"></script>
  </body>
</html>
